{% extends "base_app.html" %}

{% block title %}Product {{ object }}{% endblock %}

{% block breadcrumb %}
  <li><a href="{% url 'employees_dashboard' %}">Home</a></li>
  <li><a href="{% url 'stocks_product_list' %}">Products</a></li>
  <li class="active">{{ object }}</li>
{% endblock %}

{% block content_app %}
  <div class="row">
    <div class="col-lg-12">
      <div class="btn-toolbar" role="toolbar">
        <div class="btn-group">
          {% if user.employee.hq %}
            {% if object.is_package %}
              <a href="{% url 'stocks_package_edit' object.id %}" class="btn btn-default">
                <span class="glyphicon glyphicon-edit"></span> Edit Info
              </a>
              <a href="{% url 'stocks_package_edit_price' object.id %}" class="btn btn-default">
                <span class="glyphicon glyphicon-edit"></span> Edit Prices
              </a>
            {% else %}
              <a href="{% url 'stocks_item_edit' object.id %}" class="btn btn-default">
                <span class="glyphicon glyphicon-edit"></span> Edit
              </a>
            {% endif %}
          {% endif %}
          <a href="{% url 'stocks_product_printing_form' object.id %}" target="_blank" class="btn btn-default">
            <span class="glyphicon glyphicon-barcode"></span> Print Barcode
          </a>
        </div>
        <div class="btn-group pull-right">
          {% if object.is_package %}
            <a href="{% url 'stocks_packageitem_new' object.id %}" class="btn btn-default">
              <span class="glyphicon glyphicon-plus"></span> Add Item
            </a>
          {% else %}
            {% if user.employee.hq %}
              <a href="{% url 'stocks_itemquantity_new' object.id %}" class="btn btn-default">
                <span class="glyphicon glyphicon-plus"></span> Adjust Stock
              </a>
            {% else %}
              <a href="{% url 'stocks_itemquantitystore_new' object.id %}" class="btn btn-default">
                <span class="glyphicon glyphicon-plus"></span> Adjust Stock
              </a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-5">
      <h2>Infos</h2>
      <dl class="dl-horizontal">
        <dt>Name</dt>
        <dd>{{ object.name }}</dd>
        <dt>Barcode</dt>
        <dd><object data="{% url 'stocks_product_barcode' object.id %}" type="image/svg+xml"></object></dd>
        <dt>Retail Price (RM)</dt>
        <dd>{{ object.retail_price|floatformat:"2" }}</dd>
        <dt>Lowest Retail Price (RM)</dt>
        <dd>{{ object.lowest_retail_price|floatformat:"2" }}</dd>
        {% if user.employee.work_in_hq %}
          <dt>Wholesale Price (RM)</dt>
          <dd>{{ object.wholesale_price|floatformat:"2" }}</dd>
          <dt>Lowest Wholesale Price (RM)</dt>
          <dd>{{ object.lowest_wholesale_price|floatformat:"2" }}</dd>
          <dt>Cost Price (RM)</dt>
          <dd>{{ object.cost_price|floatformat:"2" }}</dd>
        {% endif %}
      </dl>
    </div>

    <div class="col-lg-7">
      {% if object.is_package %}
        <h2>Content</h2>
        <table class="table table-striped table-responsive">
          <thead>
            <tr>
              <th>No</th>
              <th>Model</th>
              <th>Name</th>
              <th>Quantity</th>
              <th>&nbsp;</th>
            </tr>
          </thead>
          {% with object.package.packageitem_set.all as pi_set %}
            <tfoot>
              <tr>
                <td colspan="5">Total {{ pi_set|length }} item{{ pi_set|pluralize }}</td>
              </tr>
            </tfoot>
            <tbody>
              {% for packitem in pi_set %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ packitem.item }}</td>
                  <td>{{ packitem.item.name }}</td>
                  <td>{{ packitem.quantity }} {{ packitem.item.unit_of_measure }}</td>
                  <td>
                    <a href="{% url 'stocks_packageitem_edit' packitem.id %}">
                      <span class="glyphicon glyphicon-edit"></span> Edit
                    </a>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5">Empty</td>
                </tr>
              {% endfor %}
            </tbody>
          {% endwith %}
        </table>
      {% else %}
        <h2>Stocks</h2>
        <table class="table table-striped table-responsive">
          <thead>
            <tr>
              {% if user.employee.work_in_hq %}
                <th>Warehouse</th>
              {% endif %}
              <th>Time</th>
              <th class="text-right">Quantity</th>
              <th>Reason</th>
            </tr>
          </thead>
          <tbody>
            {% for obj in quantities %}
              <tr>
                {% if user.employee.work_in_hq %}
                  <td>{{ obj.warehouse }}</td>
                {% endif %}
                <td>{{ obj.datetime }}</td>
                <td class="text-right">{{ obj.quantity }}</td>
                <td>{{ obj.get_reason_display }}</td>
              </tr>
            {% empty %}
              <tr>
                {% if user.employee.hq %}
                  <td colspan="4">
                {% else %}
                  <td colspan="3">
                {% endif %}
                No stocks available</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  </div>
{% endblock %}
