{% extends 'base_app.html' %}

{% block breadcrumb %}
<li><a href='{% url "home" %}'>Home</a></li>
<li>Wholesales</li>
<li><a href='{% url "wholesales-partner-list" %}'>Partners</a></li>
<li>{{ partner.name }}</li>
{% endblock %}

{% block content_app %}
<div class='well well-sm'>
  <div class='btn-group'>
    <a href='{% url "wholesales-partner-edit" partner.pk %}' class='btn btn-default'>Edit Info</a>
    <a href='{% url "wholesales-partner-location-edit" partner.pk %}' class='btn btn-default'>Edit Locations</a>
  </div>
</div>

<div class='row'>
  <div class='col-lg-4'>
    <div class='panel panel-default'>
      <div class='panel-heading'>Info</div>
      <div class='panel-body'>
        <dl class='dl-horizontal'>
          <dt>Name</dt>
          <dd>{{ partner.name }}</dd>
          <dt>Phone</dt>
          <dd>{{ partner.phone }}</dd>
        </dl>
      </div>
    </div>

    <div class='panel panel-default'>
      <div class='panel-heading'>Locations</div>
      {% with partner.location_set.all as location_list %}
      <table class='table table-striped table-hover table-bordered table-responsive'>
        <thead>
          <th>Name</th>
          <th>Address</th>
        </thead>
        <tbody>
          {% for location in location_list %}
          <tr>
            <td>{{ location.name }}</td>
            <td>{{ location.address|linebreaksbr }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endwith %}
    </div>
  </div>

  <div class='col-lg-8'>
    {% with partner.purchase_set.all as purchase_list %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Purchases</div>
      <table class='table table-striped table-hover table-bordered table-responsive'>
        <thead>
          <tr>
            <th>No.</th>
            <th>Order Number</th>
            <th>Invoice Number</th>
            <th class='text-right'>Total Price (RM)</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan='4'>Total {{ purchase_list|length }} purchase{{ purchase_list|pluralize }}.</td>
          </tr>
        </tfoot>
        <tbody>
          {% for purchase in purchase_list %}
          <tr>
            <td><a href='{% url "wholesales-purchase-detail" purchase.pk %}'>{{ forloop.counter }}</a></td>
            <td>{% if purchase.ordered %}{{ purchase.purchaseorder.pk }}{% else %}---{% endif %}</td>
            <td>{% if purchase.invoiced %}{{ purchase.purchaseinvoice.number }}{% else %}---{% endif %}</td>
            <td class='text-right'>{{ purchase.total_price|floatformat:'2' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endwith %}

    {% with partner.sale_set.all as sale_list %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Sales</div>
      <table class='table table-striped table-hover table-bordered table-responsive'>
        <thead>
          <tr>
            <th>No.</th>
            <th>Document No.</th>
            <th>Date</th>
            <th class='text-right'>Total Price (RM)</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan='4'>Total {{ sale_list|length }} sale{{ sale_list|pluralize }}.</td>
          </tr>
        </tfoot>
        <tbody>
          {% for sale in sale_list %}
          <tr>
            <td><a href='{% url "wholesales-sale-detail" sale.pk %}'>{{ forloop.counter }}</a></td>
            <td>{{ sale.doc_num }}</td>
            <td>{{ sale.date }}</td>
            <td class='text-right'>{{ sale.total_price|floatformat:'2' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endwith %}
  </div>
</div>
{% endblock %}
