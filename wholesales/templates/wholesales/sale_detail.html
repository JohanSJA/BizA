{% extends 'base_app.html' %}

{% block breadcrumb %}
<li><a href='{% url "home" %}'>Home</a></li>
<li>Wholesales</li>
<li><a href='{% url "wholesales-sale-list" %}'>Sales</a></li>
<li>{{ sale.pk }}</li>
{% endblock %}

{% block content_app %}
<div class='well well-sm'>
  <div class='btn-toolbar' role='toolbar'>
    <div class='btn-group'>
      {% if not sale.closed %}
      <a href='{% url "wholesales-sale-edit" sale.pk %}' class='btn btn-default'>Edit Info</a>
      <a href='{% url "wholesales-sale-saleline-edit" sale.pk %}' class='btn btn-default'>Edit Lines</a>
      {% endif %}
    </div>
    <div class='btn-group'>
      {% if sale.ordered %}
      <a href='{% url "wholesales-sale-print" sale.pk %}' target='_blank' class='btn btn-default'>Print Order</a>
      {% else %}
      <a href='{% url "wholesales-sale-place-order" sale.pk %}' class='btn btn-default'>Generate Order</a>
      {% endif %}
    </div>
    <div class='btn-group'>
      {% if sale.delivered %}
      <a href='{% url "wholesales-sale-print" sale.pk %}' target='_blank' class='btn btn-default'>Print Delivery</a>
      {% elif sale.ordered %}
      <a href='{% url "wholesales-sale-deliver" sale.pk %}' class='btn btn-default'>Generate Delivery</a>
      {% endif %}
    </div>
  </div>
</div>


<div class='row'>
  <div class='col-lg-4'>
    <div class='panel panel-default'>
      <div class='panel-heading'>Info</div>
      <div class='panel-body'>
        <dl class='dl-horizontal'>
          <dt>Partner</dt>
          <dd><a href='{% url "wholesales-partner-detail" sale.partner.pk %}'>{{ sale.partner.name }}</a></dd>
          <dt>Served By</dt>
          <dd>{{ sale.served_by }}</dd>
        </dl>
      </div>
    </div>
    {% if sale.ordered %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Order</div>
      <div class='panel-body'>
        <dl class='dl-horizontal'>
          {% with sale.saleorder as so %}
          <dt>Number</dt>
          <dd>{{ so.pk }}</dd>
          <dt>Date</dt>
          <dd>{{ so.date }}</dd>
          <dt>Term</dt>
          <dd>{{ so.term }}</dd>
          {% endwith %}
        </dl>
      </div>
    </div>
    {% endif %}
    {% if sale.delivered %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Delivery</div>
      <div class='panel-body'>
        <dl class='dl-horizontal'>
          {% with sale.saledelivery as sd %}
          <dt>Number</dt>
          <dd>{{ sd.pk }}</dd>
          <dt>Date</dt>
          <dd>{{ sd.date }}</dd>
          <dt>Address</dt>
          <dd>{{ sd.address.address|linebreaksbr }}</dd>
          {% endwith %}
        </dl>
      </div>
    </div>
    {% endif %}
  </div>

  <div class='col-lg-8'>
    {% with sale.saleline_set.all as line_list %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Lines</div>
      <table class='table table-striped table-hover table-bordered table-responsive'>
        <thead>
          <tr>
            <th>No.</th>
            <th>Description</th>
            <th class='text-right'>Unit Price (RM)</th>
            <th class='text-right'>Quantity</th>
            <th class='text-right'>Subtotal (RM)</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan='4' class='text-right'><strong>Total</strong></td>
            <td class='text-right'>{{ sale.total_price|floatformat:'2' }}</td>
          </tr>
        </tfoot>
        <tbody>
          {% for line in line_list %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ line.stock.name }}</td>
            <td class='text-right'>{{ line.unit_price|floatformat:'2' }}</td>
            <td class='text-right'>{{ line.quantity }}</td>
            <td class='text-right'>{{ line.price|floatformat:'2' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endwith %}
  </div>
</div>
{% endblock %}
