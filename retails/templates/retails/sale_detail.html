{% extends 'base_app.html' %}

{% block breadcrumb %}
<li><a href='{% url "home" %}'>Home</a></li>
<li>Retails</li>
<li><a href='{% url "retails-sale-list" %}'>Sales</a></li>
<li>{{ sale.pk }}</li>
{% endblock %}

{% block content_app %}
<div class='well well-sm'>
  <div class='btn-group'>
    {% if not sale.closed %}
    <a href='{% url "retails-sale-edit" sale.pk %}' class='btn btn-default'>Edit Info</a>
    <a href='{% url "retails-sale-line-edit" sale.pk %}' class='btn btn-default'>Edit Lines</a>
    <a href='{% url "retails-sale-close" sale.pk %}' class='btn btn-default'>Close Sale</a>
    {% endif %}
    <a href='{% url "retails-sale-print" sale.pk %}' target='_blank' class='btn btn-default'>Print Receipt</a>
  </div>
</div>

<div class='row'>
  <div class='col-lg-4'>
    <div class='panel panel-default'>
      <div class='panel-heading'>Info</div>
      <div class='panel-body'>
        <dl class='dl-horizontal'>
          <dt>Served By</dt>
          <dd>{{ sale.served_by }}</dd>
        </dl>
      </div>
    </div>

    {% if sale.closed %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Receipt</div>
      <div class='panel-body'>
        {% with sale.receipt as receipt %}
        <dl class='dl-horizontal'>
          <dt>Number</dt>
          <dd>{{ receipt.pk }}</dd>
          <dt>Generated at</dt>
          <dd>{{ receipt.timestamp }}</dd>
        </dl>
        {% endwith %}
      </div>
    </div>
    {% endif %}
  </div>

  <div class='col-lg-8'>
    {% with sale.line_set.all as line_list %}
    <div class='panel panel-default'>
      <div class='panel-heading'>Lines</div>
      <table class='table table-striped table-hover table-responsive'>
        <thead>
          <tr>
            <th>No.</th>
            <th>Description</th>
            <th class='text-right'>Unit Price (RM)</th>
            <th class='text-right'>Quantity</th>
            <th class='text-right'>Subtotal (RM)</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <td colspan='4' class='text-right'><strong>Total</strong></td>
            <td class='text-right'>{{ sale.total_price|floatformat:'2' }}</td>
          </tr>
        </tfoot>
        <tbody>
          {% for line in line_list %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ line.stock.name }}</td>
            <td class='text-right'>{{ line.unit_price|floatformat:'2' }}</td>
            <td class='text-right'>{{ line.quantity }} {{ line.stock.uom }}</td>
            <td class='text-right'>{{ line.price|floatformat:'2' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endwith %}
  </div>
</div>
{% endblock %}
